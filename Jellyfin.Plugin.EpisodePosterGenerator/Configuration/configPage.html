<!DOCTYPE html>
<html lang="en">
<head>
    <title>Episode Poster Generator</title>
</head>
<body>
<div id="EpisodePosterGeneratorConfigPage" data-role="page" class="page type-interior pluginConfigurationPage">
    <div data-role="content">
        <div class="content-primary">
            <form id="EpisodePosterGeneratorConfigForm">
                <div class="verticalSection verticalSection-extrabottompadding">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">Episode Poster Generator</h2>
                    </div>

                    <div class="sectionTitleContainer">
                        <h3 class="sectionTitle" style="width: 100%; border-bottom: 1px solid #555; padding-bottom: 0.5em; margin-bottom: 1em;">Plugin</h3>
                    </div>

                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkEnableProvider" />
                        <span>Provider</span>
                    </label>

                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkEnableTask" />
                        <span>Task</span>
                    </label>

                    <div class="sectionTitleContainer">
                        <h3 class="sectionTitle" style="width: 100%; border-bottom: 1px solid #555; padding-bottom: 0.5em; margin-bottom: 1em;">Poster</h3>
                    </div>

                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkExtractPoster" />
                        <span>Extract Poster from Episode</span>
                    </label>

                    <div class="inputContainer">
                        <label for="selectPosterStyle">Style:</label>
                        <select is="emby-select" id="selectPosterStyle">
                            <option value="Standard">Standard</option>
                            <option value="Cutout">Cutout</option>
                            <option value="Logo">Logo</option>
                            <option value="Numeral">Numeral</option>
                        </select>
                    </div>

                    <div class="inputContainer" id="selectCutoutBorderContainer">
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="chkCutoutBorder" />
                            <span>Add Cutout Text Border</span>
                        </label>
                    </div>
    
                    <div class="inputContainer" id="selectCutoutContainer">
                        <label for="selectCutoutType">Type:</label>
                        <select is="emby-select" id="selectCutoutType">
                            <option value="Code">Code</option>
                            <option value="Text">Text</option>
                        </select>
                    </div>

                    <div class="inputContainer" id="selectLogoAlignmentContainer">
                        <label for="selectLogoAlignment">Logo Alignment:</label>
                        <select is="emby-select" id="selectLogoAlignment">
                            <option value="Left">Left</option>
                            <option value="Center">Center</option>
                            <option value="Right">Right</option>
                        </select>
                    </div>

                    <div class="inputContainer" id="selectLogoPositionContainer">
                        <label for="selectLogoPosition">Logo Position:</label>
                        <select is="emby-select" id="selectLogoPosition">
                            <option value="Top">Top</option>
                            <option value="Center">Center</option>
                            <option value="Bottom">Bottom</option>
                        </select>
                    </div> 

                    <div class="inputContainer" id="selectLogoSizeContainer">
                        <label for="txtPosterSafeArea">Logo Height:</label>
                        <input is="emby-input" type="number" id="txtLogoHeight" min="1.0" max="100.0" />
                        <div class="fieldDescription">Logo height as a percentage of the poster height.</div>
                    </div>

                    <br>

                    <div class="inputContainer">
                        <label for="selectPosterFill">Fill Strategy:</label>
                        <select is="emby-select" id="selectPosterFill">
                            <option value="Original">Original</option>
                            <option value="Fill">Fill</option>
                            <option value="Fit">Fit</option>
                        </select>
                    </div>

                    <div class="inputContainer">
                        <label for="txtPosterDimensionRatio">Aspect Ratio:</label>
                        <input is="emby-input" type="text" id="txtPosterDimensionRatio" placeholder="16:9" />
                        <div class="fieldDescription">Aspect ratio for the poster (e.g., 16:9, 3:2, 4:3).</div>
                    </div>

                    <div class="inputContainer">
                        <label for="txtPosterSafeArea">Safe Area:</label>
                        <input is="emby-input" type="number" id="txtPosterSafeArea" min="1.0" max="100.0" />
                        <div class="fieldDescription">Percentage of veritcal and horizontal space that should be preserved around the edges as a safe area.</div>
                    </div>

                    <div class="sectionTitleContainer">
                        <h3 class="sectionTitle" style="width: 100%; border-bottom: 1px solid #555; padding-bottom: 0.5em; margin-bottom: 1em;">Episode Information</h3>
                    </div>

                    <div class="inputContainer" id="showEpisodeContainer">
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="chkShowEpisode" />
                            <span>Show Episode</span>
                        </label>
                    </div>

                    <div class="inputContainer" id="episodeFontFamilyContainer">
                        <label for="selectEpisodeFontFamily">Font:</label>
                        <select is="emby-select" id="selectEpisodeFontFamily">
                            <option value="Arial">Arial</option>
                            <option value="Arial Black">Arial Black</option>
                            <option value="Book Antiqua">Book Antiqua</option>
                            <option value="Calibri">Calibri</option>
                            <option value="Cambria">Cambria</option>
                            <option value="Candara">Candara</option>
                            <option value="Century Gothic">Century Gothic</option>
                            <option value="Comic Sans MS">Comic Sans MS</option>
                            <option value="Consolas">Consolas</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Didot">Didot</option>
                            <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                            <option value="Futura">Futura</option>
                            <option value="Garamond">Garamond</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Gill Sans">Gill Sans</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Impact">Impact</option>
                            <option value="Lucida Console">Lucida Console</option>
                            <option value="Lucida Sans Unicode">Lucida Sans Unicode</option>
                            <option value="Monaco">Monaco</option>
                            <option value="Optima">Optima</option>
                            <option value="Palatino Linotype">Palatino Linotype</option>
                            <option value="Rockwell">Rockwell</option>
                            <option value="Segoe UI">Segoe UI</option>
                            <option value="Tahoma">Tahoma</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Trebuchet MS">Trebuchet MS</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                        <div class="fieldDescription">Font for the episode number/season info.</div>
                    </div>

                    <div class="inputContainer" id="episodeFontStyleContainer">
                        <label for="selectEpisodeFontStyle">Font Style:</label>
                        <select is="emby-select" id="selectEpisodeFontStyle">
                            <option value="Normal">Normal</option>
                            <option value="Bold">Bold</option>
                            <option value="Italic">Italic</option>
                            <option value="Bold Italic">Bold Italic</option>
                        </select>
                        <div class="fieldDescription">Font style for the episode number/season info.</div>
                    </div>

                    <div class="inputContainer" id="episodeFontSizeContainer">
                        <label for="txtEpisodeFontSize">Font Size:</label>
                        <input is="emby-input" type="number" id="txtEpisodeFontSize" min="1.0" max="100.0" />
                        <div class="fieldDescription">Font size for the episode number/season info as a percentage of the poster height.</div>
                    </div>

                    <div class="inputContainer" id="episodeFontColorContainer">
                        <label for="txtEpisodeFontColor">Font Color:</label>
                        <input is="emby-input" type="text" id="txtEpisodeFontColor" placeholder="#FFFFFF" />
                        <div class="fieldDescription">Hex color code for episode number text (e.g., #FFFFFF for white).</div>
                    </div>

                    <div class="sectionTitleContainer">
                        <h3 class="sectionTitle" style="width: 100%; border-bottom: 1px solid #555; padding-bottom: 0.5em; margin-bottom: 1em;">Episode Title</h3>
                    </div>

                    <div class="inputContainer" id="showTitleContainer">
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="chkShowTitle" />
                            <span>Show Title</span>
                        </label>
                    </div>

                    <div class="inputContainer" id="titleFontFamilyContainer">
                        <label for="selectTitleFontFamily">Font:</label>
                        <select is="emby-select" id="selectTitleFontFamily">
                            <option value="Arial">Arial</option>
                            <option value="Arial Black">Arial Black</option>
                            <option value="Book Antiqua">Book Antiqua</option>
                            <option value="Calibri">Calibri</option>
                            <option value="Cambria">Cambria</option>
                            <option value="Candara">Candara</option>
                            <option value="Century Gothic">Century Gothic</option>
                            <option value="Comic Sans MS">Comic Sans MS</option>
                            <option value="Consolas">Consolas</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Didot">Didot</option>
                            <option value="Franklin Gothic Medium">Franklin Gothic Medium</option>
                            <option value="Futura">Futura</option>
                            <option value="Garamond">Garamond</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Gill Sans">Gill Sans</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Impact">Impact</option>
                            <option value="Lucida Console">Lucida Console</option>
                            <option value="Lucida Sans Unicode">Lucida Sans Unicode</option>
                            <option value="Monaco">Monaco</option>
                            <option value="Optima">Optima</option>
                            <option value="Palatino Linotype">Palatino Linotype</option>
                            <option value="Rockwell">Rockwell</option>
                            <option value="Segoe UI">Segoe UI</option>
                            <option value="Tahoma">Tahoma</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Trebuchet MS">Trebuchet MS</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                        <div class="fieldDescription">Font for the episode title.</div>
                    </div>

                    <div class="inputContainer" id="titleFontStyleContainer">
                        <label for="selectTitleFontStyle">Font Style:</label>
                        <select is="emby-select" id="selectTitleFontStyle">
                            <option value="Normal">Normal</option>
                            <option value="Bold">Bold</option>
                            <option value="Italic">Italic</option>
                            <option value="Bold Italic">Bold Italic</option>
                        </select>
                        <div class="fieldDescription">Font style for the episode title.</div>
                    </div>

                    <div class="inputContainer" id="titleFontSizeContainer">
                        <label for="txtTitleFontSize">Font Size:</label>
                        <input is="emby-input" type="number" id="txtTitleFontSize" min="1.0" max="100.0" />
                        <div class="fieldDescription">Font size for the episode title as a percentage of the poster height.</div>
                    </div>

                    <div class="inputContainer" id="titleFontColorContainer">
                        <label for="txtTitleFontColor">Font Color:</label>
                        <input is="emby-input" type="text" id="txtTitleFontColor" placeholder="#FFFFFF" />
                        <div class="fieldDescription">Hex color code for title text (e.g., #FFFFFF for white).</div>
                    </div>

                    <div class="sectionTitleContainer">
                        <h3 class="sectionTitle" style="width: 100%; border-bottom: 1px solid #555; padding-bottom: 0.5em; margin-bottom: 1em;">Overlay</h3>
                    </div>

                    <div class="inputContainer" id="overlayColorContainer">
                        <label for="txtOverlayColor">Overlay Color:</label>
                        <input is="emby-input" type="text" id="txtOverlayColor" placeholder="#66000000" />
                        <div class="fieldDescription">ARGB hex for background overlay (e.g., #66000000 for semi-transparent black).</div>
                    </div>

                    <br>

                    <div>
                        <button is="emby-button" type="submit" data-theme="b" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var EpisodePosterGeneratorConfig = {
            pluginId: 'b8715e44-6b77-4c88-9c74-2b6f4c7b9a1e',

            updateVisibility: function() {
                // Get current state from the form
                const posterStyle = document.getElementById('selectPosterStyle').value;
                const isShowEpisodeChecked = document.getElementById('chkShowEpisode').checked;
                const isShowTitleChecked = document.getElementById('chkShowTitle').checked;

                // Define conditions based on poster style
                const isStandard = posterStyle === 'Standard';
                const isCutout = posterStyle === 'Cutout';
                const isLogo = posterStyle === 'Logo';

                // --- Poster Style Specific Options ---
                document.getElementById('selectCutoutBorderContainer').style.display = isCutout ? 'block' : 'none';
                document.getElementById('selectCutoutContainer').style.display = isCutout ? 'block' : 'none';
                document.getElementById('selectLogoAlignmentContainer').style.display = isLogo ? 'block' : 'none';
                document.getElementById('selectLogoPositionContainer').style.display = isLogo ? 'block' : 'none';
                document.getElementById('selectLogoSizeContainer').style.display = isLogo ? 'block' : 'none';

                // --- Episode Information Section ---
                // The "Show Episode" checkbox should only be visible for styles where it's a valid option.
                const canShowEpisodeSection = isStandard || isLogo;
                document.getElementById('showEpisodeContainer').style.display = canShowEpisodeSection ? 'block' : 'none';

                // The detailed episode options should only show if the section is visible AND the box is checked.
                const showEpisodeOptions = canShowEpisodeSection && isShowEpisodeChecked;
                document.getElementById('episodeFontFamilyContainer').style.display = showEpisodeOptions ? 'block' : 'none';
                document.getElementById('episodeFontStyleContainer').style.display = showEpisodeOptions ? 'block' : 'none';
                document.getElementById('episodeFontSizeContainer').style.display = showEpisodeOptions ? 'block' : 'none';
                document.getElementById('episodeFontColorContainer').style.display = showEpisodeOptions ? 'block' : 'none';

                // --- Episode Title Section ---
                // The "Show Title" checkbox is always visible. We only toggle the detailed options below it.
                const showTitleOptions = isShowTitleChecked;
                document.getElementById('titleFontFamilyContainer').style.display = showTitleOptions ? 'block' : 'none';
                document.getElementById('titleFontStyleContainer').style.display = showTitleOptions ? 'block' : 'none';
                document.getElementById('titleFontSizeContainer').style.display = showTitleOptions ? 'block' : 'none';
                document.getElementById('titleFontColorContainer').style.display = showTitleOptions ? 'block' : 'none';
            },

            loadConfig: function () {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(this.pluginId).then(function (config) {
                    document.getElementById('chkEnableProvider').checked = config.EnableProvider || false;
                    document.getElementById('chkEnableTask').checked = config.EnableTask || false;

                    document.getElementById('selectPosterStyle').value = config.PosterStyle || 'Standard';

                    document.getElementById('chkCutoutBorder').value = config.CutoutBorder || false;
                    document.getElementById('selectCutoutType').value = config.CutoutType || 'Text';

                    document.getElementById('selectLogoAlignment').value = config.LogoAlignment || 'Text';
                    document.getElementById('selectLogoPosition').value = config.LogoPosition || 'Text';
                    document.getElementById('txtLogoHeight').value = config.LogoHeight || 25.0;

                    document.getElementById('chkExtractPoster').checked = config.ExtractPoster || false;
                    document.getElementById('selectPosterFill').value = config.PosterFill || 'Original';
                    document.getElementById('txtPosterDimensionRatio').value = config.PosterDimensionRatio || '16:9';
                    document.getElementById('txtPosterSafeArea').value = config.PosterSafeArea || 5.0;

                    document.getElementById('chkShowEpisode').checked = config.ShowEpisode !== false;
                    document.getElementById('selectEpisodeFontFamily').value = config.EpisodeFontFamily || 'Arial';
                    document.getElementById('selectEpisodeFontStyle').value = config.EpisodeFontStyle || 'Bold';
                    document.getElementById('txtEpisodeFontSize').value = config.EpisodeFontSize || 10.0;
                    document.getElementById('txtEpisodeFontColor').value = config.EpisodeFontColor || '#FFFFFF';

                    document.getElementById('chkShowTitle').checked = config.ShowTitle !== false;
                    document.getElementById('selectTitleFontFamily').value = config.TitleFontFamily || 'Arial';
                    document.getElementById('selectTitleFontStyle').value = config.TitleFontStyle || 'Bold';
                    document.getElementById('txtTitleFontSize').value = config.TitleFontSize || 7.0;
                    document.getElementById('txtTitleFontColor').value = config.TitleFontColor || '#FFFFFF';

                    document.getElementById('txtOverlayColor').value = config.OverlayColor || '#66000000';

                    EpisodePosterGeneratorConfig.updateVisibility();
                    Dashboard.hideLoadingMsg();
                }).catch(function (error) {
                    console.error('Failed to load config:', error);
                    EpisodePosterGeneratorConfig.updateVisibility();
                    Dashboard.hideLoadingMsg();
                });
            },

            saveConfig: function () {
                Dashboard.showLoadingMsg();
                var config = {
                    EnableProvider: document.getElementById('chkEnableProvider').checked,
                    EnableTask: document.getElementById('chkEnableTask').checked,

                    ExtractPoster: document.getElementById('chkExtractPoster').checked,
                    PosterFill: document.getElementById('selectPosterFill').value,
                    PosterStyle: document.getElementById('selectPosterStyle').value,

                    CutoutBorder: document.getElementById('chkCutoutBorder').checked,
                    CutoutType: document.getElementById('selectCutoutType').value,

                    LogoAlignment: document.getElementById('selectLogoAlignment').value,
                    LogoPosition: document.getElementById('selectLogoPosition').value,
                    LogoHeight: document.getElementById('txtLogoHeight').value,

                    PosterDimensionRatio: document.getElementById('txtPosterDimensionRatio').value,
                    PosterSafeArea: parseFloat(document.getElementById('txtPosterSafeArea').value),

                    ShowEpisode: document.getElementById('chkShowEpisode').checked,
                    EpisodeFontFamily: document.getElementById('selectEpisodeFontFamily').value,
                    EpisodeFontStyle: document.getElementById('selectEpisodeFontStyle').value,
                    EpisodeFontSize: parseFloat(document.getElementById('txtEpisodeFontSize').value),
                    EpisodeFontColor: document.getElementById('txtEpisodeFontColor').value,

                    ShowTitle: document.getElementById('chkShowTitle').checked,
                    TitleFontFamily: document.getElementById('selectTitleFontFamily').value,
                    TitleFontStyle: document.getElementById('selectTitleFontStyle').value,
                    TitleFontSize: parseFloat(document.getElementById('txtTitleFontSize').value),
                    TitleFontColor: document.getElementById('txtTitleFontColor').value,

                    OverlayColor: document.getElementById('txtOverlayColor').value,
                };

                ApiClient.updatePluginConfiguration(this.pluginId, config).then(function (result) {
                    Dashboard.processPluginConfigurationUpdateResult(result);
                });
            }
        };

        // --- Event Listeners ---
        document.getElementById('EpisodePosterGeneratorConfigPage').addEventListener('pageshow', function () {
            // No need to call updateVisibility here, as loadConfig will call it.
            EpisodePosterGeneratorConfig.loadConfig();
        });

        document.getElementById('EpisodePosterGeneratorConfigForm').addEventListener('submit', function (e) {
            e.preventDefault();
            EpisodePosterGeneratorConfig.saveConfig();
        });

        // Add listeners for all controls that change visibility of other elements
        document.getElementById('selectPosterStyle').addEventListener('change', function () {
            EpisodePosterGeneratorConfig.updateVisibility();
        });

        document.getElementById('chkShowEpisode').addEventListener('change', function () {
            EpisodePosterGeneratorConfig.updateVisibility();
        });

        document.getElementById('chkShowTitle').addEventListener('change', function () {
            EpisodePosterGeneratorConfig.updateVisibility();
        });
    </script>
</div>
</body>
</html>