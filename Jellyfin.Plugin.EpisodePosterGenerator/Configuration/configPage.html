<!DOCTYPE html>
<html lang="en-US">
<head>
    <title>Episode Poster Generator</title>
</head>
<body>
<div id="episodePosterConfigurationPage" data-role="page" class="page type-interior pluginConfigurationPage">
    <div data-role="content">
        <div class="content-primary">
            <form class="episodePosterConfigurationForm">
                <div class="verticalSection verticalSection-extrabottompadding">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">Episode Poster Generator Settings</h2>
                        <a is="emby-button" class="raised button-alt headerHelpButton" target="_blank"
                           href="https://github.com/JPKPribs/jellyfin-plugin-episodepostergenerator">${Help}</a>
                    </div>

                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="enablePlugin" />
                        <span>Enable Plugin</span>
                    </label>

                    <div class="inputContainer">
                        <label for="blackDetectionThreshold">Black Detection Threshold:</label>
                        <input type="number" step="0.01" id="blackDetectionThreshold" is="emby-input" />
                        <div class="fieldDescription">
                            Threshold to detect black frames (0 to 1).
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label for="blackDurationThreshold">Black Duration Threshold:</label>
                        <input type="number" step="0.01" id="blackDurationThreshold" is="emby-input" />
                        <div class="fieldDescription">
                            Minimum duration of black frames to be considered.
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label for="episodeFontSize">Episode Font Size:</label>
                        <input type="number" id="episodeFontSize" is="emby-input" />
                        <div class="fieldDescription">
                            Font size used for episode numbers.
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label for="titleFontSize">Title Font Size:</label>
                        <input type="number" id="titleFontSize" is="emby-input" />
                        <div class="fieldDescription">
                            Font size used for episode titles.
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label for="textColor">Text Color:</label>
                        <input type="text" id="textColor" is="emby-input" />
                        <div class="fieldDescription">
                            Color of the text (e.g., White, Black, #FF0000).
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label for="textPosition">Text Position:</label>
                        <input type="text" id="textPosition" is="emby-input" />
                        <div class="fieldDescription">
                            Text position on the poster (e.g., Top, Bottom, Center).
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label for="overlayImagePath">Overlay Image Path:</label>
                        <input type="text" id="overlayImagePath" is="emby-input" />
                        <div class="fieldDescription">
                            Optional path to an overlay image to apply to posters.
                        </div>
                    </div>

                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="useOverlay" />
                        <span>Use Overlay Image</span>
                    </label>

                    <div>
                        <button is="emby-button" type="submit" data-theme="b" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var EpisodePosterConfiguration = {
            uniquePluginId: "REPLACE-WITH-YOUR-PLUGIN-ID",

            loadConfiguration: function () {
                Dashboard.showLoadingMsg();

                ApiClient.getPluginConfiguration(EpisodePosterConfiguration.uniquePluginId).then(function (config) {
                    document.getElementById('enablePlugin').checked = config.EnablePlugin;
                    document.getElementById('blackDetectionThreshold').value = config.BlackDetectionThreshold;
                    document.getElementById('blackDurationThreshold').value = config.BlackDurationThreshold;
                    document.getElementById('episodeFontSize').value = config.EpisodeFontSize;
                    document.getElementById('titleFontSize').value = config.TitleFontSize;
                    document.getElementById('textColor').value = config.TextColor;
                    document.getElementById('textPosition').value = config.TextPosition;
                    document.getElementById('overlayImagePath').value = config.OverlayImagePath || '';
                    document.getElementById('useOverlay').checked = config.UseOverlay;

                    Dashboard.hideLoadingMsg();
                });
            },

            saveConfiguration: function () {
                Dashboard.showLoadingMsg();

                ApiClient.getPluginConfiguration(EpisodePosterConfiguration.uniquePluginId).then(function (config) {
                    config.EnablePlugin = document.getElementById('enablePlugin').checked;
                    config.BlackDetectionThreshold = parseFloat(document.getElementById('blackDetectionThreshold').value);
                    config.BlackDurationThreshold = parseFloat(document.getElementById('blackDurationThreshold').value);
                    config.EpisodeFontSize = parseInt(document.getElementById('episodeFontSize').value);
                    config.TitleFontSize = parseInt(document.getElementById('titleFontSize').value);
                    config.TextColor = document.getElementById('textColor').value;
                    config.TextPosition = document.getElementById('textPosition').value;
                    config.OverlayImagePath = document.getElementById('overlayImagePath').value;
                    config.UseOverlay = document.getElementById('useOverlay').checked;

                    ApiClient.updatePluginConfiguration(EpisodePosterConfiguration.uniquePluginId, config).then(function (result) {
                        Dashboard.processPluginConfigurationUpdateResult(result);
                    });
                });
            },
        };

        document.getElementById('episodePosterConfigurationPage').addEventListener('pageshow', function () {
            EpisodePosterConfiguration.loadConfiguration();
        });

        document.getElementById('episodePosterConfigurationPage').addEventListener('submit', function (e) {
            e.preventDefault();
            EpisodePosterConfiguration.saveConfiguration();
        });
    </script>
</div>
</body>
</html>